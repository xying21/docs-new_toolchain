<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CPNK56S8G3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CPNK56S8G3",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Nervos CKB" href="/docs-new_toolchain/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&display=swap">
<script src="/js/extra.js"></script><title data-react-helmet="true">Technical Bits on Polyjuice | Nervos CKB</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://xying21.github.com/docs-new_toolchain/img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image" content="https://xying21.github.com/docs-new_toolchain/img/undraw_online.svg"><meta data-react-helmet="true" property="og:url" content="https://xying21.github.com/docs-new_toolchain/docs/essays/polyjuice"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Technical Bits on Polyjuice | Nervos CKB"><meta data-react-helmet="true" name="description" content="Polyjuice is an Ethereum compatible layer and has implemented most of the functions of Ethereum on CKB,Â including running an EVM contract on CKB-VM.Â We believe that we have achieved full-featured compatibility with the implementation of EVM,which is also the power of CKB-VM.By polyjuice we want to showcase that it is perfectly possible to use account model on Nervos CKB. The flexibility here actually enables countless opportunities."><meta data-react-helmet="true" property="og:description" content="Polyjuice is an Ethereum compatible layer and has implemented most of the functions of Ethereum on CKB,Â including running an EVM contract on CKB-VM.Â We believe that we have achieved full-featured compatibility with the implementation of EVM,which is also the power of CKB-VM.By polyjuice we want to showcase that it is perfectly possible to use account model on Nervos CKB. The flexibility here actually enables countless opportunities."><link data-react-helmet="true" rel="icon" href="/docs-new_toolchain/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://xying21.github.com/docs-new_toolchain/docs/essays/polyjuice"><link data-react-helmet="true" rel="alternate" href="https://xying21.github.com/docs-new_toolchain/docs/essays/polyjuice" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xying21.github.com/docs-new_toolchain/docs/essays/polyjuice" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/docs-new_toolchain/assets/css/styles.3d7242b2.css">
<link rel="preload" href="/docs-new_toolchain/assets/js/runtime~main.ec23a73b.js" as="script">
<link rel="preload" href="/docs-new_toolchain/assets/js/main.733630ea.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs-new_toolchain/"><div class="navbar__logo"><img src="/docs-new_toolchain/img/logo.png" alt="Nervos CKB" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/docs-new_toolchain/img/logo.png" alt="Nervos CKB" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/docs-new_toolchain/docs/basics/introduction">Basics</a><a class="navbar__item navbar__link" href="/docs-new_toolchain/docs/reference/introduction">Reference</a><a class="navbar__item navbar__link" href="/docs-new_toolchain/docs/essays/introduction">Essays</a><a class="navbar__item navbar__link" href="/docs-new_toolchain/docs/develop/developer-materials-guide">Develop</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/lifecycle">Transaction validation lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/debug">Tips for debugging CKB script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/pprof">Tips for profiling CKB script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/rules">The General Workflow for Constructing a Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/dependencies">Script dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs-new_toolchain/docs/essays/polyjuice">Technical Bits on Polyjuice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/faq">CKB FAQs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/ckb-core-dev">Tips for CKB development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/integrity-check">Integrity Check for CKB Release</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-new_toolchain/docs/essays/mint-sudt-via-contract">Mint SUDT via Contract</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Technical Bits on Polyjuice</h1></header><p><a href="https://github.com/nervosnetwork/polyjuice" target="_blank" rel="noopener noreferrer">Polyjuice</a> is an Ethereum compatible layer and has implemented most of the functions of Ethereum on CKB,Â including running an EVM contract on CKB-VM.Â We believe that we have achieved full-featured compatibility with the implementation of EVM,which is also the power of CKB-VM.By polyjuice we want to showcase that it is perfectly possible to use account model on Nervos CKB. The flexibility here actually enables countless opportunities.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="basic-concepts">Basic Concepts<a aria-hidden="true" class="hash-link" href="#basic-concepts" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="account">Account<a aria-hidden="true" class="hash-link" href="#account" title="Direct link to heading">â€‹</a></h3><p>There are two kinds of accounts, contract account, and EoA account.</p><p><strong>Contract Account</strong></p><p> The contract account in Polyjuice is a cell constrained by Polyjuice type script. The type script args is a <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0022-transaction-structure/0022-transaction-structure.md#type-id" target="_blank" rel="noopener noreferrer"><code>type_id</code></a> value so that the type script is unique. The first 32 bytes of the cell data is the <code>storage root</code> (sparse-merkle-tree) of the contract. The second 32 bytes of the cell data is the <code>code_hash</code> (<code>blake2b(code)</code>) of the contract. Since we want everyone to use the contract, we default the use of an always success lock script. We can also use any lock script for access control or other purposes.</p><p><strong>EoA Account</strong></p><p>The EoA account in Polyjuice is all live cells locked by default secp256k1 sighash lock script. The id of the account is the lock script args.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="contract">Contract<a aria-hidden="true" class="hash-link" href="#contract" title="Direct link to heading">â€‹</a></h3><p>A contract in Polyjuice is mostly the same as an ethereum contract. You can write your contract in Solidity, Vyper, or Assembly, then compile to EVM byte code. There are some minor differences. Since it&#x27;s <strong>impossible</strong> to read block information from the current block, we instead read block information from the most recent block. The most recent means the latest block of blocks includes the transaction inputs:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">max(block_number(inputs))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It will effect following op codes:</p><ul><li><code>BLOCKHASH</code> </li><li><code>COINBASE</code> </li><li><code>TIMESTAMP</code></li><li><code>NUMBER</code></li><li><code>DIFFICULTY</code></li><li><code>GASLIMIT</code></li></ul><p>The <code>DIFFICULTY</code> value is the difficulty of <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0020-ckb-consensus-protocol/0020-ckb-consensus-protocol.md#dynamic-difficulty-adjustment-mechanism" target="_blank" rel="noopener noreferrer">Nervos CKB chain</a>. The <code>GASLIMIT</code> here is a constant value, which equals the max value of <code>int64_t </code>(9223372036854775807). The transaction cost is determined by its size and <a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0014-vm-cycle-limits/0014-vm-cycle-limits.md" target="_blank" rel="noopener noreferrer">cycles</a>, so gas limit is meaningless in Polyjuice.</p><p> The <code>COINBASE</code> return value and <code>SELFDESTRUCT</code> beneficiary address are the first 20 bytes of lock script hash, which is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">blake2b(lock_script)[0..20]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="program">Program<a aria-hidden="true" class="hash-link" href="#program" title="Direct link to heading">â€‹</a></h3><p>A program is a <code>CREATE</code> or <code>CALL</code> with parameters. Since polyjuice supports contract call contract, a polyjuice transaction can contain multiple programs, which will be serialized and put into witness.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="generator">Generator<a aria-hidden="true" class="hash-link" href="#generator" title="Direct link to heading">â€‹</a></h3><p>Polyjuice generator can generate a Polyjuice transaction through JSONRPC API as below:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn create(sender: H160, code: Bytes) -&gt; TransactionReceipt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn call(sender: H160, contract_address: H160, input: Bytes) -&gt; TransactionReceipt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="validator">Validator<a aria-hidden="true" class="hash-link" href="#validator" title="Direct link to heading">â€‹</a></h3><p>Polyjuice validator is the type script that verifies the transformation of contract cells.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="indexer">Indexer<a aria-hidden="true" class="hash-link" href="#indexer" title="Direct link to heading">â€‹</a></h3><p>Indexer is a Polyjuice module for indexing every Polyjuice transaction in CKB block. The contract metadata, alteration, and all the logs emitted from the Polyjuice transaction will be saved. Also, all live cells will be indexed for running the generator (build Polyjuice transaction).</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="design-details">Design Details<a aria-hidden="true" class="hash-link" href="#design-details" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-organize-cells-in-a-ckb-transaction">How to organize cells in a CKB transaction?<a aria-hidden="true" class="hash-link" href="#how-to-organize-cells-in-a-ckb-transaction" title="Direct link to heading">â€‹</a></h3><img src="/docs-new_toolchain/assets/images/polyjuice-transaction-structure-9234b8a127cfdd9fc26f7e7a9239e25a.jpg" width="600"><p>If the picture is not clear, please clickï¼š
<strong><a href="https://github.com/TheWaWaR/polyjuice/blob/docs/docs/assets/polyjuice-transaction-structure.pdf" target="_blank" rel="noopener noreferrer">Organize cells in a CKB transaction</a></strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-ckb-transaction-generation-process">The CKB transaction generation process<a aria-hidden="true" class="hash-link" href="#the-ckb-transaction-generation-process" title="Direct link to heading">â€‹</a></h3><img src="/docs-new_toolchain/assets/images/polyjuice-how-generator-works-1f5bc5615400ce064ec0747af04cbe33.jpg" width="600"><p>If the picture is not clear, please clickï¼š
<strong><a href="https://github.com/TheWaWaR/polyjuice/blob/docs/docs/assets/polyjuice-how-generator-works.pdf" target="_blank" rel="noopener noreferrer">CKB transaction generation process</a></strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-ckb-transaction-validation-process">The CKB transaction validation process<a aria-hidden="true" class="hash-link" href="#the-ckb-transaction-validation-process" title="Direct link to heading">â€‹</a></h3><img src="/docs-new_toolchain/assets/images/polyjuice-how-validator-works-665c47b8a838a156c893e9cf0f39b894.jpg" width="600"><p>If the picture is not clear, please clickï¼š
<strong><a href="https://github.com/TheWaWaR/polyjuice/blob/docs/docs/assets/polyjuice-how-validator-works.pdf" target="_blank" rel="noopener noreferrer">CKB transaction validation process</a></strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="communicate-through-ckb-vm-syscalls">Communicate through ckb-vm syscalls<a aria-hidden="true" class="hash-link" href="#communicate-through-ckb-vm-syscalls" title="Direct link to heading">â€‹</a></h3><p>In Generator and Indexer, we use syscalls to handle the event emitted from the program execution process. The syscalls we currently used are shown below:</p><ul><li>2177 is for ckb_debug, useful when you want to debug the generator.</li><li>3075 is for returning the EVM result.</li><li>3076 is for logging.</li><li>3077 is for saving <code>SELFDESTRUCT</code> beneficiary address.</li><li>3078 is for handle CALL and CREATE opcodes.</li><li>3079 is for returning code size of a contract to EVM.</li><li>3080 is for returning a coded slice of a contract to EVM.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="implementation-details">Implementation Details<a aria-hidden="true" class="hash-link" href="#implementation-details" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-handle-contract-creation">How to handle contract creation?<a aria-hidden="true" class="hash-link" href="#how-to-handle-contract-creation" title="Direct link to heading">â€‹</a></h3><p>A <code>CREATE</code> from a sender (EoA account) or contract will lead to contract creation. In generator,  the created cell will be assigned a type_id type script, and the contract code hash will be saved in the data field next to the account storage root hash. In validator, type script will check the contract code hash match the code_hash in the data field.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-handle-contract-destruction">How to handle contract destruction?<a aria-hidden="true" class="hash-link" href="#how-to-handle-contract-destruction" title="Direct link to heading">â€‹</a></h3><p>Contract destruction only happens when a <code>SELFDESTRUCT</code> opcode is executed. In the generator, the destructed contract cell is consumed as input, then put an output cell as the beneficiary cell, and the beneficiary address is the corresponding secp256k1 sighash lock script.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-generate-a-contract-call-contract-ckb-transaction">How to generate a contract call contract CKB transaction?<a aria-hidden="true" class="hash-link" href="#how-to-generate-a-contract-call-contract-ckb-transaction" title="Direct link to heading">â€‹</a></h3><p>When CALL or CREATE opcode is invoked in EVM, we call it a contract call contract transaction. When invoking CALL opcode, generator load contract code and latest storage from the database or saved state (the contract has already been loaded from database) by destination and execute it. When CREATE opcode executed after EVM started, the generator will put an output cell just like how contract creation works.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-validate-contract-call-contract-ckb-transaction">How to validate contract call contract CKB transaction?<a aria-hidden="true" class="hash-link" href="#how-to-validate-contract-call-contract-ckb-transaction" title="Direct link to heading">â€‹</a></h3><p>The first contract created or called by EoA account we call it <strong>entrance</strong> contract, other contracts if there is any, we call them normal contracts. Only one program is allowed in <strong>the entrance</strong> contract, and all its calls to normal contracts&#x27; programs must match the order and count. All normal contracts&#x27; calls to sub normal contracts&#x27; programs must check they match the request. Since multiple contracts may call one contract, the count can not be checked by a normal contract. Normal contracts only check their own programs, and <strong>the entrance</strong> contract will check all programs in current CKB transaction that are being called with the restricted sequence.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-verify-the-contract-sender-eoa-account">How to verify the contract sender (EoA account)?<a aria-hidden="true" class="hash-link" href="#how-to-verify-the-contract-sender-eoa-account" title="Direct link to heading">â€‹</a></h3><p>Since EVM execution will use the sender information, we require the sender to sign the Polyjuice transaction and put the signature into witness. The sign content must include two parts:</p><ol><li>transaction hash  </li><li>all contracts&#x27; related witnesses </li></ol><p>The contract-related witness is serialized as part of the <code>WitnessArgs</code> molecule structure, and the information is located in input_type (contract call/destruction) field or output_type (contract creation) field.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-handle-logs">How to handle logs?<a aria-hidden="true" class="hash-link" href="#how-to-handle-logs" title="Direct link to heading">â€‹</a></h3><p>In validator, the logs are just being ignored. When the generator generates the Polyjuice transaction, the logs are saved and returned as part of the transaction receipt. When the Indexer processes the Polyjuice transaction, the logs are saved to the database for users to query.</p><p> In generator and Indexer the logs are trigged by LOG opcode, then:</p><ol><li>callback function <code>emit_log</code> is called</li><li>emit_log invoke a log syscall with topics and data as arguments</li><li>Rust syscall handler function is called, the arguments been extracted and saved</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-new_toolchain/docs/essays/dependencies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Script dependencies</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-new_toolchain/docs/essays/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CKB FAQs<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-concepts" class="table-of-contents__link toc-highlight">Basic Concepts</a><ul><li><a href="#account" class="table-of-contents__link toc-highlight">Account</a></li><li><a href="#contract" class="table-of-contents__link toc-highlight">Contract</a></li><li><a href="#program" class="table-of-contents__link toc-highlight">Program</a></li><li><a href="#generator" class="table-of-contents__link toc-highlight">Generator</a></li><li><a href="#validator" class="table-of-contents__link toc-highlight">Validator</a></li><li><a href="#indexer" class="table-of-contents__link toc-highlight">Indexer</a></li></ul></li><li><a href="#design-details" class="table-of-contents__link toc-highlight">Design Details</a><ul><li><a href="#how-to-organize-cells-in-a-ckb-transaction" class="table-of-contents__link toc-highlight">How to organize cells in a CKB transaction?</a></li><li><a href="#the-ckb-transaction-generation-process" class="table-of-contents__link toc-highlight">The CKB transaction generation process</a></li><li><a href="#the-ckb-transaction-validation-process" class="table-of-contents__link toc-highlight">The CKB transaction validation process</a></li><li><a href="#communicate-through-ckb-vm-syscalls" class="table-of-contents__link toc-highlight">Communicate through ckb-vm syscalls</a></li></ul></li><li><a href="#implementation-details" class="table-of-contents__link toc-highlight">Implementation Details</a><ul><li><a href="#how-to-handle-contract-creation" class="table-of-contents__link toc-highlight">How to handle contract creation?</a></li><li><a href="#how-to-handle-contract-destruction" class="table-of-contents__link toc-highlight">How to handle contract destruction?</a></li><li><a href="#how-to-generate-a-contract-call-contract-ckb-transaction" class="table-of-contents__link toc-highlight">How to generate a contract call contract CKB transaction?</a></li><li><a href="#how-to-validate-contract-call-contract-ckb-transaction" class="table-of-contents__link toc-highlight">How to validate contract call contract CKB transaction?</a></li><li><a href="#how-to-verify-the-contract-sender-eoa-account" class="table-of-contents__link toc-highlight">How to verify the contract sender (EoA account)?</a></li><li><a href="#how-to-handle-logs" class="table-of-contents__link toc-highlight">How to handle logs?</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Foundation</div><ul class="footer__items"><li class="footer__item"><a href="https://www.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developer</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Whitepaper</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs" target="_blank" rel="noopener noreferrer" class="footer__link-item">RFCs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://www.reddit.com/r/NervosNetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li><li class="footer__item"><a href="https://t.me/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCONuJGdMzUY0Y6jrPBOzH7A" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021  Nervos Foundation. All Rights Reserved.</div></div></div></footer></div>
<script src="/docs-new_toolchain/assets/js/runtime~main.ec23a73b.js"></script>
<script src="/docs-new_toolchain/assets/js/main.733630ea.js"></script>
</body>
</html>