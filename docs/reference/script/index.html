<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CPNK56S8G3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CPNK56S8G3",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Nervos CKB" href="/develop/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&display=swap">
<script src="/js/extra.js"></script><title data-react-helmet="true">Script | Nervos CKB</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://xying21.github.com/develop/img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image" content="https://xying21.github.com/develop/img/undraw_online.svg"><meta data-react-helmet="true" property="og:url" content="https://xying21.github.com/develop/docs/reference/script"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Script | Nervos CKB"><meta data-react-helmet="true" name="description" content="If you are used to blockchains like Ethereum, you will recognize that CKB leverages a drastically different verification model: instead of creating a transaction that alters blockchain state when executing, a transaction in CKB contains state transitions directly in the form of cells. To alter the state of an existing cell, one just destroys the original cell, then create a new one in a single, atomic transaction. CKB scripts, running on CKB VM, actually perform series of validation rules on the input cells and output cells of the transaction."><meta data-react-helmet="true" property="og:description" content="If you are used to blockchains like Ethereum, you will recognize that CKB leverages a drastically different verification model: instead of creating a transaction that alters blockchain state when executing, a transaction in CKB contains state transitions directly in the form of cells. To alter the state of an existing cell, one just destroys the original cell, then create a new one in a single, atomic transaction. CKB scripts, running on CKB VM, actually perform series of validation rules on the input cells and output cells of the transaction."><link data-react-helmet="true" rel="icon" href="/develop/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://xying21.github.com/develop/docs/reference/script"><link data-react-helmet="true" rel="alternate" href="https://xying21.github.com/develop/docs/reference/script" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://xying21.github.com/develop/docs/reference/script" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/develop/assets/css/styles.3d7242b2.css">
<link rel="preload" href="/develop/assets/js/runtime~main.9a7d223e.js" as="script">
<link rel="preload" href="/develop/assets/js/main.b81bb0ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/develop/"><div class="navbar__logo"><img src="/develop/img/logo.png" alt="Nervos CKB" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/develop/img/logo.png" alt="Nervos CKB" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/develop/docs/basics/introduction">Basics</a><a class="navbar__item navbar__link" href="/develop/docs/reference/introduction">Reference</a><a class="navbar__item navbar__link" href="/develop/docs/labs/introduction">Labs</a><a class="navbar__item navbar__link" href="/develop/docs/integrate/introduction">Integrate</a><a class="navbar__item navbar__link" href="/develop/docs/essays/introduction">Essays</a><a class="navbar__item navbar__link" href="/develop/docs/develop/developer-materials-guide">Develop</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/develop/docs/reference/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/develop/docs/reference/cell">Cell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/develop/docs/reference/script">Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/develop/docs/reference/transaction">Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/develop/docs/reference/rpc">JSON-RPC</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Script</h1></header><p>If you are used to blockchains like Ethereum, you will recognize that CKB leverages a drastically different verification model: instead of creating a transaction that alters blockchain state when executing, a transaction in CKB contains state transitions directly in the form of cells. To alter the state of an existing cell, one just destroys the original cell, then create a new one in a single, atomic transaction. CKB scripts, running on CKB VM, actually perform series of validation rules on the input cells and output cells of the transaction.</p><p>In this section we will look closer at the data structure of scripts, and explain how lock scripts and type script work together to ensure the validation rules of CKB.</p><p>Notes: we will distinguish between <strong>script code</strong> and <strong>script</strong>ï¼š</p><ul><li><strong>script code</strong> refers to the compiled program you write and deploy to CKB. It is the actual binary CKB VM will run to perform validation rules.</li><li><strong>script</strong> refers to the script data structure use by <code>lock script</code> and <code>type script</code> in <a href="/develop/docs/reference/cell">Cell</a> data structure.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="data-structure">Data Structure<a aria-hidden="true" class="hash-link" href="#data-structure" title="Direct link to heading">â€‹</a></h2><p>Both <code>lock script</code> and <code>type script</code> use the same data structureï¼š<strong>Script</strong></p><p><strong>Example:</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;hash_type&quot;: &quot;type&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;code_hash&quot;: &quot;0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;args&quot;: &quot;0xc285e812f6a35c2479d6f5b9bbaa357dd4e60da1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;hash_type&quot;: &quot;data&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;code_hash&quot;: &quot;0xe7f93d7120de3ca8548b34d2ab9c40fe662eec35023f07e143797789895b4869&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;args&quot;: &quot;0x42b5561f13c2a8f7c710843bea7d179656dc6133a98b7d763cebc6e74c8ba72a&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A script has three fieldsï¼š</p><ul><li><p><code>code_hash</code>: A hash denoting which script in the transaction to execute. For space consideration, the actual script code is kept in the cell data part of a <a href="/develop/docs/reference/cell#live-cell">live cell</a> on CKB. The current transaction should reference the live cell using a <a href="/develop/docs/reference/transaction">cell dep</a> so as to locate and execute the script.</p></li><li><p><code>hash_type</code>: The interpretation of <code>code_hash</code> when looking for script code to run from cell deps.</p><ul><li><p>If <code>hash_type</code> contains <code>data</code>, <code>code_hash</code> should match the blake2b hash of data(which is also the actual script code) in a dep cell;</p></li><li><p>if <code>hash_type</code> contains <code>type</code>, <code>code_hash</code> should instead match the blake2b hash of type script contained by a a dep cell. Note CKB will throw a validation error when a) we are locating a script code using <code>type</code> as <code>hash_type</code>; and b) more than one cell referenced by cell deps contains the specified hash of type script.</p><p>The combination of a <code>code_hash</code> and a <code>hash_type</code>, will uniquely identify a script code in CKB.</p></li></ul></li><li><p><code>args</code>: Auxiliary arguments for a script. This is why we need to distinguish between <code>script code</code> and <code>script</code> above: through <code>args</code>, a <code>script</code> actually represents an <strong>instance</strong> of a <code>script code</code>. Typical examples include:</p><ul><li>While a single <code>script code</code> will be used for secp256k1 implementation, different people might include different public keys into <code>args</code> to create different <code>script</code>s, which lead to different wallets.</li><li>While a single <code>script code</code> might provide implementation for the <a href="https://talk.nervos.org/t/rfc-simple-udt-draft-spec/4333" target="_blank" rel="noopener noreferrer">UDT</a> specification, different people might inject different <code>args</code> for different types of tokens.</li></ul></li></ul><p>We will talk about how to execute a script to validate transaction structure in sections below.</p><p>Depending on the different types, scripts will be executed at different times:</p><ol><li>All lock scripts from all input cells in a transaction will be executed.</li><li>All type scripts(if exist) from all input cells and output cells in a transaction will be executed.</li></ol><p>We will consider the transaction valid only when all the required scripts complete with a success status. Failure in any script will mark the transaction as invalid.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="execution">Execution<a aria-hidden="true" class="hash-link" href="#execution" title="Direct link to heading">â€‹</a></h2><p>Here we are providing a basic introduction for script execution flow, for the more precise definition, please refer to the following RFCs:</p><ul><li><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0003-ckb-vm/0003-ckb-vm.md" target="_blank" rel="noopener noreferrer">CKB VM</a></li><li><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0009-vm-syscalls/0009-vm-syscalls.md" target="_blank" rel="noopener noreferrer">VM Syscalls</a></li><li><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0014-vm-cycle-limits/0014-vm-cycle-limits.md" target="_blank" rel="noopener noreferrer">VM Cycle Limits</a></li></ul><p>Each script that needs to be executed from a CKB transaction, will be run in a <a href="https://github.com/nervosnetwork/ckb-vm" target="_blank" rel="noopener noreferrer">CKB VM</a> instance. At its core, CKB VM is just an implementation of the <a href="https://riscv.org/" target="_blank" rel="noopener noreferrer">RISC-V</a> Instruction Set Architecture(ISA). It means any RISC-V standard compliant program(RV64IMC to be more precise, see the RFCs for more details) will be accepted by CKB VM. The common <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="noopener noreferrer">ELF</a> format is used to package a binary.</p><p>To use a RISC-V program as a script on CKB, one simply needs to create a new <a href="/develop/docs/reference/cell">cell</a> with the full program binary in the cell&#x27;s data part. One the transaction generating the new cell is committed on CKB, scripts can then be assembled to use the program as script code. As mentioned above, a cell dep entry must be also create to reference the newly created cell containing script code.</p><p>There are cases that RISC-V ISA is not be enough, for example, a script might want to read information from the enclosing transaction to enforce validation rules, CKB provides a series of <code>syscalls</code> that will handle this task. Notice <code>syscall</code> is a concept also designed and included by the RISC-V standard ISA, we are confronting to RISC-V standard specification as much as we can.</p><p>To prevent infinite loops, <code>cycles</code> are introduced to CKB VM. Each executed RISC-V instruction and each syscall made will consume certain amount of cycles. At consensus layer, CKB has a hard limit on the maximum cycles that is allowed in a single block. The total cycles consumed by all executed scripts, from all transactions included in a blocks, must not exceed this number. Otherwise the block will be rejected.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="use-cases">Use Cases<a aria-hidden="true" class="hash-link" href="#use-cases" title="Direct link to heading">â€‹</a></h2><p>Lock script and type script share the identical running environment, they can all access all the information contained in its enclosing transaction. But due to the fact they are executed in different times, they have formed into different use cases.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="lock-script">Lock Script<a aria-hidden="true" class="hash-link" href="#lock-script" title="Direct link to heading">â€‹</a></h3><p>Lock scripts are more for representing ownerships. Typical use cases for lock scripts include:</p><ul><li>Signature verification</li><li>Lock period ensurance</li></ul><p>You might notice that type script can actually replace all functionalities of a lock script, meaning a cell can use a dummy lock script that does nothing, and rely on type script for all behaviors. But that is an anti-pattern of CKB now. By making lock script mandatory, we want to ensure each cell at least uses a secure lock script.</p><p>Lock script can be viewed as the last defense to ensure that your tokens stay safe. So we do recommend to keep your lock as simple as possible, to avoid the potential of vulnerabilities.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="type-script">Type Script<a aria-hidden="true" class="hash-link" href="#type-script" title="Direct link to heading">â€‹</a></h3><p>Type script, on the other hand, is where innovations would more likely to happen on CKB. Some use cases of type scripts include:</p><ul><li>User Defined Token(UDT) implementation</li><li>Ensuring cell data confronts to a certain format</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/develop/docs/reference/cell"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Cell</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/develop/docs/reference/transaction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transaction<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-structure" class="table-of-contents__link toc-highlight">Data Structure</a></li><li><a href="#execution" class="table-of-contents__link toc-highlight">Execution</a></li><li><a href="#use-cases" class="table-of-contents__link toc-highlight">Use Cases</a><ul><li><a href="#lock-script" class="table-of-contents__link toc-highlight">Lock Script</a></li><li><a href="#type-script" class="table-of-contents__link toc-highlight">Type Script</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Foundation</div><ul class="footer__items"><li class="footer__item"><a href="https://www.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About Us</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developer</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0002-ckb/0002-ckb.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Whitepaper</a></li><li class="footer__item"><a href="https://github.com/nervosnetwork/rfcs" target="_blank" rel="noopener noreferrer" class="footer__link-item">RFCs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/AqGTUE9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://talk.nervos.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://www.reddit.com/r/NervosNetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li><li class="footer__item"><a href="https://t.me/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/nervosnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCONuJGdMzUY0Y6jrPBOzH7A" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021  Nervos Foundation. All Rights Reserved.</div></div></div></footer></div>
<script src="/develop/assets/js/runtime~main.9a7d223e.js"></script>
<script src="/develop/assets/js/main.b81bb0ca.js"></script>
</body>
</html>